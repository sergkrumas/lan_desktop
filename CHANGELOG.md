
### 1й раунд разработки (август 2023 - 13 февраля 2024)
- добавлен чат из примеров Qt, который я портировал на PyQt. В процессе пришлось отказаться от QCBORStreamWriter и QCBORStreamReader и воспользоваться модулем cbor2, так как питоновская обёртка QCBORStreamWriter не видит некоторых Qt-шных методов объекта, а питоновская обёртка QCBORStreamReader не даёт прочитать записанную строку через PyQt в принципе, выдавая ошибку питоновской обёртки - SystemError: sipBuildResult(): invalid format string "NF". Модуль cbor2 работает так же просто как и модуль json.
    - на основе этого чата будет разрабатываться LAN-DESKTOP
    - помимо отправки сообщений в пределах локальной сети чат умеет искать пиров и сообщает об их подключении как только так сразу

### 2й раунд разработки, версия 0.90 (13 февраля 2024 - 30 марта 2024)
- теперь интерфейс задаётся полностью кодом. Между текстом чата и списком пиров добавлен сплиттер, который можно перемещать мышкой
- (21 мар 24) успешно осуществлена передача скриншота с Linux Mint на виртуальной машине в Windows 10 на физической машине. Работает и в случае двух копий на одной машине, тогда в одном из чатов придётся включать флалок `Send Screenshot`. Полученный скриншот сохраняется в папке приложения с именем f'{time.time()}'.jpg и пока ещё не отображается в самой приложухе. Решена проблема долгой передачи картинки: метод чтения читал слишком мало данных
- (21 мар 24) полученный скриншот теперь выводится в окне, окно отображается сразу при получении скриншота
- (25 мар 24) изменил струтуру передачи по TCP (по UDP передача осталась прежней)
    - раньше было так:
        - 4 байта для размера сообщения (big-endian)
        - тело соообщения (cbor2 binary)
    - теперь будет так:
        - 4 байта для совокупного размера serial-сообщения и binary-сообщения (big-endian)
        - 4 байта для размера serial-сообщения (big-endian)
        - 4 байта для размера binary-сообщения (big-endian)
        - тело serial-сообщения (cbor2 binary)
        - тело binary-сообщения (attached binary)
- (25 мар 24) чекбокс «Send Screenshot» переименован в «Allow Remote Control». Его активация даёт возможность управлять компьютером извне. При запуске в Linux чекбокс автоматически активируется. Этот чекбокс существует для целей разработки и в дальнейшем весь UX будет пересмотрен.
- (25 мар 24) теперь через ведомое приложение можно указать область захвата: захватывать все мониторы или только какой-то один. Кастомная область захвата будет добавлена поздней. Вдобавок вместе со скриншотом приходят координаты прямоугольника области захвата
- (26 мар 24) добавил мгновенное закрытие приложения при нажатии клавиши `Escape`
- (26 мар 24) передача событий мышки (левая, правая, колесо)
    - пофиксил расхождение в размерах области захвата и размерах изображения
    - ограничение генерации управляющих данных: для генерации курсор должен находиться поверх картики
    - реализована тестовая передача координат курсора (элементы интерфейса должны менять отрисовку при наведении курсора, например, на объекты на рабочем столе и на часы в трее в Linux Mint). Пока нормального маппинга не реализовано и окно вьюпорта должно иметь одинаковые размеры с область захвата
    - реализован маппинг координат (ведь изображение отрисовывается без соблюдения масштаба и не всегда в левом верхнем углу, для того чтобы втиснуться в текущие размеры окна)
    - реализована передача инфы о зажатии и отпускании кнопок мыши
        - левой (уже работают перетаскивания)
        - правой
        - средней (колесо)
    - реализована передача инфы о вращениях колеса мыши
- (26 мар 24) добавил менюбар ко вьюпорту с командой закрытия приложения
- (26 мар 24) в заголовке вьюпорта отображается адрес удалённого компьютера, управление которым производится
- (26 мар 24) во вьюпорте теперь отображаются нажимаемые и отпускаемые клавиши для целей дебага
- (26 мар 24) написан транслятор данных: Qt-атрибуты событий нажатия клавиш транслируются в аргументы для функций pyautogui
- (26 мар 24) реализована передача инфы о зажатых и отпущенных клавишах клавиатуры
- (26 мар 24) переписал отрисовку вьюпорта так, чтобы менюбар не перекрывал изображение
- (26 мар 24) если не удалось транслировать нажимаемую клавишу в понятный аргумент для функций модуля pyautogui, то по периметру вьюпорта временно появится покраснение
- (26 мар 24) поддеркжа клавиши `Win` для вызова меню «Пуск» (работает даже в Linux)
- (26 мар 24) в менюбар добавлено меню, которое помогает высылать хоткеи из предопределённого набора
    - `Ctrl+Alt+Del`
    - `Ctrl+Break`
    - `Insert`
    - `Print Screen`
    - `Alt+PrintScreen`
    - `Shift+Tab`
- (27 мар 24) отображение лога нажимаемых клавиш теперь можно контролировать в подменю «View» главного меню
- (27 мар 24) заметка: порой становлюсь жертвой забывчивости и забываю перезагружать работающую копию в виртуалке, и из-за этого долго не могу понять почему ничего не работает
- (27 мар 24) заметка: если в выводе программа пишет, что читает сообщение громадного размера, то значит в программе произошло исключение на каком-то этапе, и из-за этого читалка CBOR2 сбилась. Надо просто остановить программу и взглянуть на её вывод, который, к слову, несётся очень быстро.
- (27 мар 24) отображение управляющих команд у клиента (отображение появляется в окне слева внизу у панели задач, появляется как только будет принято хоть одно управляющее сообщение)
    - клавиши клавиатуры
    - кнопки мыши (левая, правая, средняя)
    - сочетания клавиш
    - кручение колеса мыши
- (27 мар 24) проверил работу подменю из главного меню, которое передаёт заранее заданные сочетания клавиш
- (27 мар 24) поддержка произвольной области захвата
    - добавлена опция в интерфейс
    - создан виджет для задания произвольной области захвата, с помощью мыши можно как изменить его размеры, так и перенести
    - написана функция, которая создаёт скриншот произвольной области захвата
    - реализация логики в интерфейсе
- (27 мар 24) передача файлов в обе стороны
    - код приёма сброшенных файлов на окно чата
    - код отправки файлов
    - код приёма файлов
    - сообщение в чат об отправке каждой части
    - сообщение в чат о получении каждой части
    - сообщение в чат о завершении закачки файла (о получении завершающей части файла)
- (27 мар 24) UX: добавлена галочка для отображения лога нажимаемых клавиш на ведомом компьютере
- (28 мар 24) баг: при завершении перекачки файла порой не удаётся с первой попытки переименовать файл, так как в него ещё записываются данные. В итоге файл оставался непереименованным, теперь это исправлено
- (30 мар 24) добавлены лейблы для отображения фреймрейта генерации скриншота и фреймрейта получения скриншота
- (30 мар 24) галочка для блокировки вывода текста в консоль (вывод текста в консоль может отжирать фреймрейт, в полтора-два раза)
- (30 мар 24) попытки повысить FPS и снизить задержку кадров
    - таймер отправки скриншотов теперь пытается работать так, чтобы было 25 FPS, но это не всегда возможно
    - отключил дурацкий ping-pong, присутствующий в коде чата изначально. Его отключение помогло убрать ощутимую задержку кадров
    - попробовал задавать размеры входящих и исходящих буферов для сокетов, а также размер специального буфера через QAbstractSocket::setReadBufferSize, но либо это не помогло, либо я не заметил этого, потому что другие параметры были выставлены уже как надо. Хотя в документации сказано, что размер третьего буфера лучше ограничивать, чтобы там ничего долго не копилось.
- (30 мар 24) обнаружен баг: в Linux Mint виджет задания области захвата не даёт кликать сквозь себя. Пока не знаю как это фиксить, но Linux меня пока особо не интересует
- (30 мар 24) pyautogui выбрасывает исключение, если координаты для функции pyautogui.moveTo выходят за допустимые пределы. Пока засунул вызов этой функции в try_except, но вообще надо проверять при отравке координаты или просто клампить их
- (30 мар 24) заметка насчёт FPS: если курсор не находится над изображением вьюпорта, то FPS поднимается в два раза. Видимо, обработка управляющих сообщений с координатами мыши забирает ресурсы у ведомого компьютера
- (30 мар 24) сохранение списка пиров и сохранение их MAC-адресов
    - нашёл место в программе, из которого можно организовать обмен mac-адресами
    - в файл папки приложения сохраняется список пиров и их mac-адресов при обмене mac-адресами
    - после запуска список заполняется сохранёнными парами IP- и MAC. После отключении пира его запись остаётся в списке с префиксом `[inactive]`. При подключении запись с префиксом `[inactive]` стирается
    - появилась кнопка, благодаря которой можно посылать сигналы WakeOnLan на выключенные компьютеры
- (30 мар 24) если связь потеряна (более двух секунд не приходили обновления), то картинка во вьюпорте конвертируется в чёрнобелую и выводится сообщение о недоступности ведомого компьютера. При восстановлении связи чёрнобелая картинка и сообщение сгинут
- (30 мар 24) прошёл тестовый прогон на реальных компьютерах: ведущий (Windows 10) и ведомый (Windows 10)
    - работает как предполагалось, разрешение захвата было 2560x1440
- (30 мар 24) успешно протестирована кнопка WakeOnLAN
- (30 мар 24) мощно затупил и забыл написать адекватный маппинг координат из портала для случая, когда происходит захвата со второго монитора или из произвольной области захвата. В итоге косяк исправлен теперь
- (30 мар 24) теперь LAN-DESKTOP почти готов, работает более-менее сносно. Осталось только придать этому всему приемлемый UI и UX, чем я и займусь в апреле

### 3й раунд разработки, версия 0.91 (30 марта 2024 - ???????)
- (2 апр 24) добавлен скрипт для обновления программы прямо из репозитория
- (4 апр 24) обновление из репозитория теперь можно выполнить из главного меню программы
    - добавлена автоматическая перезагрузка после обновления
- (4 апр 24) переработана визуальная основа окна (чат слева, список пиров справа, по центру будет портал)
    - (4 апр 24) портал (вьюпорт) перенесён в главное окно с чатом
    - (4 апр 24) удалил лишнюю менюшку из главного меню портала
- (4 апр 24) добавлено несколько UX-плюшек
    - иконка в трее и контекстное меню к ней
    - запись трейсбэка в случае необработанного исключения в файл `crash.log`
    - в главное меню добавлен пункт благодаря которому приложение может запускаться при старте Windows
    - FPS приёма теперь отображается в правом верхнем углу портала
    - пункт меню «Update» теперь запрашивает подтверждение
- (5 апр 24) теперь поддерживается русская раскладка (и заодно все остальные прочие) для клавиатурного ввода в портале
- (5 апр 24) фокус ввода клавиатуры теперь активируется кликом внутри портала
- (5 апр 24) портал теперь можно панорамировать и зумить во время специального режима редактирования, который активируется через пункт «Editing Mode» главного меню портала
- (6 апр 24) запрещаем отсылать информацию о зажатых клавишах, если портал находится в режиме редактирования
- (6 апр 24) частотой захвата FPS теперь можно управлять из главного меню портала `View > Set FPS to...`
- (6 апр 24) задание нестандартной области захвата из портала
    - заметка: в Linux виджет задания области не работает, а конкретно не пропускает через свои прозрачные области клики мышки на окна, находящиеся под ним
    - перенёс систему задания рамки из OXXXY (https://github.com/sergkrumas/oxxxy)
    - отрисовывается чёрная подложка под всю площадь портала
    - управление
        - зумирование через вращение колеса мыши
        - панорамирование через перемещение с зажатым колесом мыши
        - задание области захвата через перемещение с зажатой левой кнопкой мыши
    - прописал отрисовку инфы о заданной пользователем области захвата
    - отправка данных об области захвата и завершение специального режима редактирования через клавиши `Enter` или `Return` во время режима редактирования
    - принятие данных на ведомом комьютере
    - (7 апр 24) отправка картинки с ведомого компьютера и отрисовка заданной области в портале
        - координаты мыши адекватно мапятся вроде как
    - комбобокс с вариантами захвата больше не нужен, захватом можно будет управлять из подменю главного меню портала
    - (7 апр 24) UX: перенос кастомной области захвата при переносе курсора мыши внутри кастомной области захвата с удержанием левой кнопки мыши
    - (7 апр 24) UX: добавлена возможность обнуления кастомной области захвата (`View > Reset user-defined capture region`)
    - (7 апр 24) новая функция `View > Fit capture to portal` даёт возможность целиком вместить в портале либо всю картинку, либо её предзаданную область
- (7 апр 24) включил сглаживание всех видов для портала
- (7 апр 24) проверил приложение на адекватную работу при задании области захвата выходящей за пределы основной области
- (7 апр 24) в чат добавляется системное сообщение при смене числа мониторов
- (7 апр 24) UX: из главного меню портала теперь можно управлять захватом мониторов ведомого компьютера
- (7 апр 24) UX: в верхнем правом углу портала отображается информация о мониторе, с которого приходит захват
- (7 апр 24) anticrash: если захват был настроен на второй монитор и этот монитор отключили, то приложуха не упадёт и переключится на первый монитор
- (7 апр 24) UX: при измении принимаемой области захвата автоматически вызывается команда меню `View > Fit capture to portal`
- (7 апр 24) в списке пиров заведены иконки: серый - не в сети, зелёный - в сети
- (7 апр 24) UX: если пир не поддерживает ведомость, то при нахождении в сети в списке у него будет красная иконка, а не зелёная
- (7 апр 24) функция обновления переработана так, чтобы не удалять все файлы из папки, а только те, для которых есть обновления
- (30 апр 24) галочка Allow remote control запоминается в файле настроек
- (30 апр 24) портал теперь скрывается после старта приложения
- (30 апр 24) убрал фокус со всех кнопок, чтобы они не срабатывали
- (30 апр 24) добавил кнопки Maximize и Minimize для главного окна
- (30 апр 24) убрал фокус со всех чекбоксов
- (30 апр 24) подключение к ведомому компьютеру через кнопку `Open Portal`
    - автоматического подключения к ведомому компьютеру больше нет
    - чтобы подключится к нужному пиру, надо выбрать его в списке и нажать кнопку `Open Portal`; если всё пройдёт удачно, то распахнётся свёрнутый портал
    - статус занятости: удалённый управляемый хост говорит всем при попытке подключения, что он занят, если кто-то успел к нему подключится заранее, и не даёт подключиться на занятый комп для целей управления. Занято будет до тех пор пока не разрывается соединение с управляющим компьютером
    - теперь можно отсоединится от ведомого компьютера
    - ведомый компьютер не будет принимать управляющие данные, если предварительно с ним не было успешно установленно портальное соединение
- (8 май 24) неявное требование дисконекта при открытии портала по новому адресу: пока не отключишься от одного - не подключишься к другому
- (8 май 24) состояние портала адекватно изменяется после намеренного дисконнекта
- (8 май 24) в пользовательском режиме приложение запускается в трее и окно не показывается, пока не кликнуть левой кнопкой по иконке в трее, в режиме дебага окно отобразится сразу
- (17 май 24) галочка для отключения вывода системных сообщений в чат
- (18 май 24) при задании специальной области захвата под конец можно нажать на кнопку вместо того чтобы нажимать клавиши `Return` или `Enter`
- (18 май 24) временно разобрался с исключением, которая всплывает при вызове `Connection.deleteLater()`. В итоге просто перестал вызывать этот самый `deleteLater` и исключений нет. Надо бы ещё дополнительно сказать, что в примере, из которого выросла эта программа, класс `Connection` унаследовался от `QTCPSocket`
```
File "_lan_desktop.py", line 1942, in disconnected
    self.removeConnection(socket)
File "_lan_desktop.py", line 1963, in removeConnection
    connection.deleteLater()
File "_lan_desktop.py", line 1448, in deleteLater
    super().deleteLater()
```
- (18 май 24) доработал функцию переноса области захвата (когда я её внедрял, то я её не дописал толком, и в результате была заблокирована функция переопределения области захвата)
- (17 май 25) зависание: копия программы на Windows зависает, когда я включаю копию программы на стороне Linux
    - при попытке записать список пиров `Globals.update_peers_list` linux-копия начинала создавать дополнительные файлы-локи, видимо потому, что записывается список из треда чтения
    - решил залочить вызов `Globals.update_peers_list`, теперь таких ситуаций происходить не должно
    - однако, что интересно, проблема ушла до того, как я поставил лок
